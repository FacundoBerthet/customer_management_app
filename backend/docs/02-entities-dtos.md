# Entities, DTOs, and Mappers

This backend focuses on a single resource: Customer. Below is what the entity looks like, the validation rules, and how requests/responses should be shaped. A DTO layer can be added, but the current API already works with a simple shape.

## Entity: Customer

JPA entity mapped to the `customer` table.

Fields
- `id: Long` — primary key, generated by the database (`GenerationType.IDENTITY`).
- `firstName: String` — required, 2..40 chars.
- `lastName: String` — required, 2..40 chars.
- `email: String` — required, valid email format, unique.
- `phone: String` — optional, must match `XXX-XXXX` when present.
- `address: String` — optional, max 100 chars.
- `createdAt: LocalDateTime` — read-only; set by app/DB.
- `updatedAt: LocalDateTime` — read-only; set by app/DB.

Validation annotations (high level)
- `@NotBlank` on firstName, lastName, email.
- `@Size` on firstName, lastName, address.
- `@Email` on email.
- `@Pattern("^$|^\\d{3}-\\d{4}$")` on phone.
- `@Column(unique = true)` on email for uniqueness.

Timestamps
- The entity sets timestamps on constructors and updates `updatedAt` on setters.
- Flyway also sets DB defaults (`NOW()`) and backfills nulls, so inserts outside the app still get timestamps.

ID generation
- `GenerationType.IDENTITY` fits PostgreSQL `BIGSERIAL`/identity columns and matches the Flyway migrations.

Example Customer JSON (response)
```json
{
	"id": 1,
	"firstName": "John",
	"lastName": "Doe",
	"email": "john.doe@example.com",
	"phone": "123-4567",
	"address": "123 Main St",
	"createdAt": "2025-08-10T12:34:56",
	"updatedAt": "2025-08-10T12:40:00"
}
```

## DTOs (recommended shapes)

The API can accept/return the same shape as the entity, but DTOs make contracts clearer. Suggested DTOs:

- CustomerCreateRequest
	- `firstName` (required)
	- `lastName` (required)
	- `email` (required)
	- `phone` (optional)
	- `address` (optional)

- CustomerUpdateRequest
	- same fields as create; for `PUT` we expect the full object (server keeps `id`, timestamps read-only)

- CustomerResponse
	- `id`, `firstName`, `lastName`, `email`, `phone`, `address`, `createdAt`, `updatedAt`

Example create request
```json
{
	"firstName": "Jane",
	"lastName": "Smith",
	"email": "jane.smith@example.com",
	"phone": "555-1234",
	"address": "742 Evergreen Terrace"
}
```

Example update request (PUT /api/customers/1)
```json
{
	"firstName": "Jane",
	"lastName": "Smith",
	"email": "jane.smith@example.com",
	"phone": "555-9999",
	"address": "742 Evergreen Terrace"
}
```

Notes
- Timestamps are read-only in the API; the server sets them.
- Email must be unique; duplicates return a conflict error.
- For `PUT`, send the full object (replace semantics). If you add `PATCH` later, you can support partial updates.

## Mapping rules

- Create: map create request → entity; ignore `id`, set timestamps.
- Update: find entity by path `id`, copy fields from update request; do not change `id`, timestamps set automatically.
- Response: map entity → response; include `id` and timestamps.

## Error cases

- 400 Bad Request: validation failures (e.g., missing required fields, invalid formats).
- 404 Not Found: id not found.
- 409 Conflict: unique constraint violation (email already exists).

See: [Error handling](05-error-handling.md) and [Controllers and endpoints](03-controllers-endpoints.md).
